<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Analyse &mdash; ECIT</title>
    <link rel="stylesheet" href="/static/css/style.css?v=9">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-brand">
                <svg fill="currentColor" viewBox="0 0 135 60" xmlns="http://www.w3.org/2000/svg" class="logo" aria-label="ECIT"><path d="M12.438 31.2701C12.7007 27.7664 14.7153 21.635 22.7737 21.635C28.8175 21.635 31.5328 24.9635 32.6715 31.2701H12.438ZM45.1095 39.1533C46.073 25.2263 38.5401 12.2628 23.1241 12.2628C9.37226 12.2628 0 22.5985 0 36.1752C0 50.1898 8.84672 60 23.1241 60C33.3723 60 40.8175 55.5328 44.3212 44.7591H33.3723C32.5839 47.562 28.5547 50.6277 23.562 50.6277C16.5547 50.6277 12.7883 47.1241 12.438 39.1533H45.1095Z"></path><path d="M94.3849 29.4307C93.6841 17.8686 83.7863 12.2628 73.1002 12.2628C58.3849 12.2628 49.9761 22.6861 49.9761 36.7883C49.9761 50.365 59.1732 60 72.8374 60C84.8374 60 92.9834 53.4307 94.6476 41.4307H82.6476C81.8593 47.0365 78.6184 50.6277 72.7498 50.6277C64.9542 50.6277 62.4141 42.9197 62.4141 36.3504C62.4141 29.6934 65.0418 21.635 73.0126 21.635C78.3557 21.635 81.4214 24.2628 82.2097 29.4307H94.3849Z"></path><path d="M100.901 5.63466H106.42V0.114198H100.901V5.63466ZM100.901 58.7737H106.42V13.5766H100.901V58.7737Z"></path><path d="M125.74 0H120.221V13.5766H112.338V18.219H120.221V49.1387C120.134 56.8467 122.674 59.2993 130.032 59.2993C131.696 59.2993 133.272 59.1241 134.937 59.1241V54.3942C133.36 54.5693 131.783 54.6569 130.207 54.6569C126.265 54.3942 125.74 52.292 125.74 48.7007V18.219H134.937V13.5766H125.74V0Z"></path></svg>
                <div class="divider"></div>
                <span class="app-name">HR Analyse</span>
            </div>
            <div class="header-actions">
                <span id="status-badge" class="badge">Laster...</span>
                <button id="btn-pdf" class="btn btn-primary" onclick="downloadPDF()">Last ned PDF</button>
                <div id="user-menu" class="user-menu">
                    <button id="btn-login" class="btn btn-secondary" onclick="showLoginModal()">Logg inn</button>
                    <div id="user-info" class="user-info hidden">
                        <span id="user-name"></span>
                        <span id="user-role" class="user-role-badge"></span>
                        <button class="btn-user-action" onclick="doLogout()" title="Logg ut">&#x2715;</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- LOGIN MODAL -->
    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Velg bruker</h3>
                <button class="modal-close" onclick="hideLoginModal()">&#x2715;</button>
            </div>
            <div class="modal-body">
                <select id="login-user-select" size="6" class="login-user-list"></select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="doLogin()">Logg inn</button>
                <button class="btn btn-outline" onclick="hideLoginModal()">Avbryt</button>
            </div>
        </div>
    </div>

    <!-- PIN MODAL -->
    <div id="pin-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Fest graf til dashboard</h3>
                <button class="modal-close" onclick="hidePinModal()">&#x2715;</button>
            </div>
            <div class="modal-body">
                <p class="modal-desc">Graf: <strong id="pin-modal-title"></strong></p>
                <label class="modal-label" id="pin-profile-label">
                    Hvor vil du feste grafen?
                    <select id="pin-profile-select" class="pin-profile-dropdown"></select>
                </label>
                <p class="modal-hint" id="pin-modal-hint"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="confirmPin()">Fest graf</button>
                <button class="btn btn-outline" onclick="hidePinModal()">Avbryt</button>
            </div>
        </div>
    </div>

    <nav id="tab-nav">
        <button class="tab active" data-tab="oversikt">Oversikt</button>
        <button class="tab" data-tab="analyse">Analyse</button>
        <button class="tab" data-tab="churn">Churn</button>
        <button class="tab" data-tab="tenure">Tenure</button>
        <button class="tab" data-tab="lonn">L&oslash;nn</button>
        <button class="tab" data-tab="sok">S&oslash;k</button>
        <button class="tab" data-tab="import">Import</button>
        <button class="tab tab-admin hidden" data-tab="admin">Admin</button>
    </nav>

    <main>
        <!-- OVERSIKT -->
        <section id="tab-oversikt" class="tab-content active">
            <div class="cards" id="overview-cards"></div>
            <div class="grid-2">
                <div class="chart-container">
                    <h3>Ansettelsestyper</h3>
                    <canvas id="chart-employment-types"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Heltid vs deltid</h3>
                    <canvas id="chart-fulltime-parttime"></canvas>
                </div>
            </div>
            <div class="dashboard-preset-bar">
                <span class="preset-label">Dashboard-profil:</span>
                <select id="dashboard-preset">
                    <option value="" disabled>Laster...</option>
                </select>
            </div>
            <div id="pinned-charts-container"></div>
        </section>

        <!-- GEOGRAFI (fjernet — dekkes av Analyse) -->

        <!-- KJØNN (fjernet — dekkes av Analyse) -->

        <!-- CHURN -->
        <section id="tab-churn" class="tab-content">
            <div class="controls">
                <label>
                    Fra:
                    <input type="date" id="churn-start">
                </label>
                <label>
                    Til:
                    <input type="date" id="churn-end">
                </label>
                <button class="btn btn-secondary" onclick="loadChurnPeriod()">Beregn periode</button>
            </div>
            <div id="churn-summary-cards" class="cards"></div>
            <div class="chart-container">
                <h3>M&aring;nedlig churn</h3>
                <canvas id="chart-churn-monthly"></canvas>
            </div>
            <div class="grid-2">
                <div class="chart-container">
                    <h3>Churn per aldersgruppe</h3>
                    <canvas id="chart-churn-age"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Churn per land</h3>
                    <canvas id="chart-churn-country"></canvas>
                </div>
            </div>
            <div class="grid-2">
                <div class="chart-container">
                    <h3>Churn per kj&oslash;nn</h3>
                    <canvas id="chart-churn-gender"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Oppsigelse&aring;rsaker</h3>
                    <canvas id="chart-churn-reasons"></canvas>
                </div>
            </div>
        </section>

        <!-- TENURE -->
        <section id="tab-tenure" class="tab-content">
            <div class="cards" id="tenure-cards"></div>
            <div class="grid-2">
                <div class="chart-container">
                    <h3>Ansettelsestid fordeling</h3>
                    <canvas id="chart-tenure-dist"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Heltid vs deltid</h3>
                    <canvas id="chart-tenure-ft-pt"></canvas>
                </div>
            </div>
        </section>

        <!-- L&Oslash;NN -->
        <section id="tab-lonn" class="tab-content">
            <div class="cards" id="salary-cards"></div>
            <div class="chart-container">
                <h3>L&oslash;nn per kj&oslash;nn (l&oslash;nnsforskjell)</h3>
                <canvas id="chart-salary-gender"></canvas>
            </div>
        </section>

        <!-- JOBBFAMILIER (fjernet — dekkes av Analyse) -->

        <!-- ANALYSE -->
        <section id="tab-analyse" class="tab-content">
            <div class="analyse-controls controls">
                <div class="analyse-row analyse-primary">
                    <label>
                        Hva vil du m&aring;le?
                        <select id="analyse-metric"></select>
                    </label>
                    <label>
                        Hvordan dele opp?
                        <select id="analyse-group-by"></select>
                    </label>
                    <button class="btn btn-primary" onclick="runAnalysis()">Vis analyse</button>
                </div>

                <details id="analyse-extra-options">
                    <summary>Flere valg</summary>
                    <div class="analyse-row analyse-secondary">
                        <label>
                            Ekstra inndeling
                            <select id="analyse-split-by">
                                <option value="">Ingen</option>
                            </select>
                        </label>
                        <label class="filter-inline">
                            Filtrer p&aring;
                            <span class="filter-selects">
                                <select id="analyse-filter-dim">
                                    <option value="">Ingen filter</option>
                                </select>
                                <select id="analyse-filter-val" disabled>
                                    <option value="">Velg filter f&oslash;rst</option>
                                </select>
                            </span>
                        </label>
                    </div>
                </details>

                <details id="analyse-templates-section">
                    <summary>Maler</summary>
                    <div class="analyse-row analyse-secondary">
                        <label>
                            Velg mal
                            <select id="analyse-template-list">
                                <option value="">Ingen lagrede maler</option>
                            </select>
                        </label>
                        <button class="btn btn-secondary" onclick="loadTemplate()">Last inn</button>
                        <button class="btn btn-outline" onclick="saveTemplate()">Lagre mal</button>
                        <button class="btn btn-outline" onclick="deleteTemplate()" style="color:var(--red);border-color:var(--red)">Slett</button>
                    </div>
                </details>
            </div>

            <div id="analyse-chart-types" class="chart-type-selector hidden">
                <span class="chart-type-label">Graftype:</span>
                <div class="chart-type-pills" id="analyse-pills"></div>
            </div>

            <div id="analyse-result" class="chart-container hidden">
                <div class="chart-header">
                    <h3 id="analyse-chart-title">Resultat</h3>
                    <div class="chart-actions">
                        <button class="btn-chart-action" id="btn-pin-analyse" title="Fest til oversikt" onclick="showPinModal()">
                            &#x1F4CC;
                        </button>
                    </div>
                </div>
                <canvas id="chart-analyse"></canvas>
            </div>
        </section>

        <!-- S&Oslash;K -->
        <section id="tab-sok" class="tab-content">
            <div class="controls">
                <input type="text" id="search-name" placeholder="Navn...">
                <input type="text" id="search-dept" placeholder="Avdeling...">
                <input type="text" id="search-country" placeholder="Land...">
                <input type="text" id="search-company" placeholder="Selskap...">
                <label class="checkbox-label">
                    <input type="checkbox" id="search-active" checked> Kun aktive
                </label>
                <button class="btn btn-primary" onclick="doSearch()">S&oslash;k</button>
            </div>
            <div id="search-results"></div>
        </section>

        <!-- IMPORT -->
        <section id="tab-import" class="tab-content">
            <div class="import-area">
                <div id="drop-zone" class="drop-zone">
                    <p>Dra og slipp en Excel-fil her</p>
                    <p class="small">eller</p>
                    <label class="btn btn-secondary file-label">
                        Velg fil
                        <input type="file" id="file-input" accept=".xlsx,.xls" hidden>
                    </label>
                </div>
                <div class="import-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="import-clear"> Slett eksisterende data f&oslash;r import
                    </label>
                </div>
                <div id="import-status"></div>
            </div>
            <div class="import-history">
                <h3>Import-historikk</h3>
                <div id="import-history-list"></div>
            </div>
        </section>

        <!-- ADMIN -->
        <section id="tab-admin" class="tab-content">
            <h2 class="section-title">Brukere</h2>
            <div id="admin-users-list"></div>
            <div class="admin-form" id="admin-add-user-form">
                <h3 class="admin-form-title">Legg til bruker</h3>
                <div class="admin-form-row">
                    <label>
                        Navn
                        <input type="text" id="admin-user-name" placeholder="Ola Nordmann">
                    </label>
                    <label>
                        E-post
                        <input type="text" id="admin-user-email" placeholder="ola@ecit.no">
                    </label>
                    <label>
                        Rolle
                        <select id="admin-user-role">
                            <option value="bruker">Bruker</option>
                            <option value="admin">Admin</option>
                        </select>
                    </label>
                    <button class="btn btn-primary" onclick="adminCreateUser()">Opprett</button>
                </div>
            </div>

            <h2 class="section-title" style="margin-top:32px;">Dashboard-profiler</h2>
            <div id="admin-profiles-list"></div>
            <div class="admin-form" id="admin-add-profile-form">
                <h3 class="admin-form-title">Legg til profil</h3>
                <div class="admin-form-row">
                    <label>
                        Navn
                        <input type="text" id="admin-profile-name" placeholder="Ny profil">
                    </label>
                    <label>
                        Beskrivelse
                        <input type="text" id="admin-profile-desc" placeholder="Beskrivelse...">
                    </label>
                    <button class="btn btn-primary" onclick="adminCreateProfile()">Opprett</button>
                </div>
            </div>
        </section>

        <!-- LASTEINDIKATOR -->
        <div id="loader" class="loader hidden">
            <div class="spinner"></div>
        </div>

        <!-- TOM TILSTAND -->
        <div id="empty-state" class="empty-state hidden">
            <h2>Ingen data</h2>
            <p>Importer en Excel-fil for &aring; komme i gang.</p>
            <button class="btn btn-primary" onclick="switchTab('import')">G&aring; til import</button>
        </div>
    </main>

    <footer>
        ECIT HR Analyse &mdash; Intern bruk
    </footer>

    <script src="/static/js/chart.min.js"></script>
    <script src="/static/js/charts.js?v=8"></script>
    <script src="/static/js/app.js?v=9"></script>
</body>
</html>
